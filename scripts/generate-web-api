#!/usr/bin/env node
var async = require('async')
var api = require('../src/api.json')
var methods = Object.keys(api)
var join = require('path').join
var write = require('fs').writeFileSync

function writeCode(ns, callback) {
  var method = `
// this file was generated by ./scripts/generate-web-api
import exec from './_exec'
import validate from './_validate'
import {Promise} from 'es6-promise'

export default function ${ns.replace(/\./g, '')}(params, callback) {
  return new Promise(function(resolve, reject) {
    let ns = '${ns}'
    let err = validate(ns, params)
    if (err) {
      reject(err);
      callback && callback(err);
    }
    else {
      exec(ns, params, function(err, res) {
        if(err) {
          reject(err);
          callback && callback(err);
        } else {
          resolve(res);
          callback && callback(res);
        }
      });
    }    
  });
}
`
  var file = join(__dirname, '..', 'src', `${ns}.js`)
  write(file, method)
}

async.each(methods, writeCode)
